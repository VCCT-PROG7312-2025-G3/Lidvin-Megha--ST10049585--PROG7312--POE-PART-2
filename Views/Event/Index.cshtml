@model PROG7312_POEPART2.Models.EventViewModel
@{
    ViewData["Title"] = "Local Events & Announcements";
}

<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="gradient-header p-5 rounded-4 text-white">
                <h1 class="display-4 fw-bold mb-2">
                    <i class="bi bi-calendar-event me-3"></i>Local Events & Announcements
                </h1>
                <p class="lead mb-0">Discover exciting events happening in your community</p>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <form asp-action="Index" method="get" id="searchForm">
                        <div class="row g-3">
                            <!-- Search Input -->
                            <div class="col-md-4">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-search me-2"></i>Search Events
                                </label>
                                <input type="text" class="form-control form-control-lg"
                                       name="searchTerm" value="@Model.SearchTerm"
                                       placeholder="Search by title, description, or tags...">
                            </div>

                            <!-- Category Filter -->
                            <div class="col-md-2">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-tag me-2"></i>Category
                                </label>
                                <select class="form-select form-select-lg" name="category">
                                    <option value="">All Categories</option>
                                    @foreach (var cat in Model.Categories)
                                    {
                                        <option value="@cat" selected="@(cat == Model.SelectedCategory)">
                                            @cat (@Model.CategoryCount.GetValueOrDefault(cat, 0))
                                        </option>
                                    }
                                </select>
                            </div>

                            <!-- Start Date -->
                            <div class="col-md-2">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-calendar-check me-2"></i>Start Date
                                </label>
                                <input type="date" class="form-control form-control-lg"
                                       name="startDate" value="@Model.StartDate?.ToString("yyyy-MM-dd")">
                            </div>

                            <!-- End Date -->
                            <div class="col-md-2">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-calendar-x me-2"></i>End Date
                                </label>
                                <input type="date" class="form-control form-control-lg"
                                       name="endDate" value="@Model.EndDate?.ToString("yyyy-MM-dd")">
                            </div>

                            <!-- Search Button -->
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    <i class="bi bi-search me-2"></i>Search
                                </button>
                            </div>
                        </div>

                        <!-- Quick Filters -->
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="d-flex gap-2 flex-wrap">
                                    <span class="badge bg-secondary p-2">Quick Filters:</span>
                                    @foreach (var cat in Model.Categories.Take(6))
                                    {
                                        <a href="@Url.Action("Category", new { category = cat })"
                                           class="badge bg-light text-dark p-2 text-decoration-none border">
                                            @cat (@Model.CategoryCount.GetValueOrDefault(cat, 0))
                                        </a>
                                    }
                                    <a asp-action="HighPriority" class="badge bg-warning text-dark p-2 text-decoration-none">
                                        <i class="bi bi-star-fill me-1"></i>High Priority
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Searches (Stack Implementation) -->
    @if (Model.RecentSearches != null && Model.RecentSearches.Any())
    {
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-info border-0 shadow-sm">
                    <h6 class="mb-2">
                        <i class="bi bi-clock-history me-2"></i>Recent Searches (Stack):
                    </h6>
                    <div class="d-flex gap-2 flex-wrap">
                        @foreach (var search in Model.RecentSearches)
                        {
                            <span class="badge bg-info">
                                @if (!string.IsNullOrEmpty(search.SearchTerm))
                                {
                                    <text>"@search.SearchTerm"</text>
                                }
                                @if (!string.IsNullOrEmpty(search.Category))
                                {
                                    <text>in @search.Category</text>
                                }
                                <small class="ms-1">(@search.SearchTimestamp.ToString("HH:mm"))</small>
                            </span>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Recommendations Section -->
    @if (Model.RecommendedEvents != null && Model.RecommendedEvents.Any())
    {
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm bg-gradient-recommendation">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-3">
                            <i class="bi bi-stars me-2 text-warning"></i>
                            Recommended for You
                            <small class="text-muted fs-6">(Based on your search patterns)</small>
                        </h4>
                        <div class="row g-3">
                            @foreach (var evt in Model.RecommendedEvents.Take(3))
                            {
                                <div class="col-md-4">
                                    <div class="card h-100 border-warning recommendation-card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <span class="badge bg-warning text-dark">@evt.Category</span>
                                                <span class="badge bg-danger">Priority: @evt.Priority</span>
                                            </div>
                                            <h6 class="card-title">@evt.Title</h6>
                                            <p class="card-text small text-muted">
                                                <i class="bi bi-calendar3 me-1"></i>
                                                @evt.EventDate.ToString("MMM dd, yyyy")
                                            </p>
                                            <p class="card-text small">@evt.Description.Substring(0, Math.Min(80, evt.Description.Length))...</p>
                                            <a asp-action="Details" asp-route-id="@evt.Id"
                                               class="btn btn-sm btn-outline-warning stretched-link">
                                                View Details
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Statistics Section -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center border-0 shadow-sm stat-card">
                <div class="card-body">
                    <i class="bi bi-calendar-event fs-1 text-primary"></i>
                    <h3 class="mt-2 mb-0">@Model.Events.Count</h3>
                    <p class="text-muted mb-0">Events Found</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center border-0 shadow-sm stat-card">
                <div class="card-body">
                    <i class="bi bi-tags fs-1 text-success"></i>
                    <h3 class="mt-2 mb-0">@Model.Categories.Count</h3>
                    <p class="text-muted mb-0">Categories</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center border-0 shadow-sm stat-card">
                <div class="card-body">
                    <i class="bi bi-clock-history fs-1 text-info"></i>
                    <h3 class="mt-2 mb-0">@Model.RecentSearches.Count</h3>
                    <p class="text-muted mb-0">Recent Searches</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center border-0 shadow-sm stat-card">
                <div class="card-body">
                    <i class="bi bi-star-fill fs-1 text-warning"></i>
                    <h3 class="mt-2 mb-0">@Model.RecommendedEvents.Count</h3>
                    <p class="text-muted mb-0">Recommendations</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Events Grid -->
    <div class="row">
        <div class="col-12">
            <h3 class="mb-3">
                @if (!string.IsNullOrEmpty(Model.SelectedCategory))
                {
                    <text>Events in @Model.SelectedCategory</text>
                }
                else if (!string.IsNullOrEmpty(Model.SearchTerm))
                {
                    <text>Search Results for "@Model.SearchTerm"</text>
                }
                else
                {
                    <text>Upcoming Events</text>
                }
            </h3>
        </div>
    </div>

    @if (Model.Events.Any())
    {
        <div class="row g-4">
            @foreach (var evt in Model.Events)
            {
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 event-card border-0 shadow-sm">
                        <div class="card-img-top-wrapper position-relative">
                            <div class="event-image-placeholder bg-gradient-primary text-white d-flex align-items-center justify-content-center"
                                 style="height: 200px;">
                                <i class="bi bi-calendar-event display-1"></i>
                            </div>
                            <span class="position-absolute top-0 end-0 m-3 badge bg-primary">
                                @evt.Category
                            </span>
                            @if (evt.Priority >= 4)
                            {
                                <span class="position-absolute top-0 start-0 m-3 badge bg-danger">
                                    <i class="bi bi-star-fill me-1"></i>Featured
                                </span>
                            }
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title mb-3">@evt.Title</h5>

                            <div class="event-meta mb-3">
                                <p class="mb-2">
                                    <i class="bi bi-calendar3 text-primary me-2"></i>
                                    <strong>@evt.EventDate.ToString("MMMM dd, yyyy")</strong>
                                </p>
                                <p class="mb-2">
                                    <i class="bi bi-clock text-success me-2"></i>
                                    @evt.EventDate.ToString("h:mm tt")
                                </p>
                                <p class="mb-2">
                                    <i class="bi bi-geo-alt text-danger me-2"></i>
                                    @evt.Location
                                </p>
                                <p class="mb-2">
                                    <i class="bi bi-people text-info me-2"></i>
                                    Capacity: @evt.Capacity
                                </p>
                            </div>

                            <p class="card-text text-muted mb-3">
                                @evt.Description.Substring(0, Math.Min(120, evt.Description.Length))...
                            </p>

                            <!-- Tags -->
                            <div class="mb-3">
                                @foreach (var tag in evt.Tags.Take(3))
                                {
                                    <span class="badge bg-secondary me-1">#@tag</span>
                                }
                            </div>

                            <div class="mt-auto d-flex gap-2">
                                <a asp-action="Details" asp-route-id="@evt.Id"
                                   class="btn btn-primary flex-grow-1">
                                    <i class="bi bi-info-circle me-2"></i>View Details
                                </a>
                                <button class="btn btn-outline-secondary" title="Add to favorites">
                                    <i class="bi bi-heart"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-footer bg-light border-0">
                            <small class="text-muted">
                                <i class="bi bi-person me-1"></i>
                                Organized by: @evt.Organizer
                            </small>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-12">
                <div class="alert alert-warning border-0 shadow-sm text-center p-5">
                    <i class="bi bi-search display-4 mb-3"></i>
                    <h4>No events found</h4>
                    <p class="mb-3">Try adjusting your search filters or browse all upcoming events.</p>
                    <a asp-action="Index" class="btn btn-primary">
                        <i class="bi bi-arrow-clockwise me-2"></i>Clear Filters
                    </a>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .gradient-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .bg-gradient-recommendation {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    }

    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .event-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
        }

    .recommendation-card {
        transition: transform 0.3s ease;
        border: 2px solid #ffc107;
    }

        .recommendation-card:hover {
            transform: scale(1.03);
        }

    .stat-card {
        transition: transform 0.3s ease;
    }

        .stat-card:hover {
            transform: translateY(-3px);
        }

    .form-control:focus, .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
    }

    .event-meta i {
        font-size: 1.1rem;
    }

    .badge {
        font-weight: 500;
    }
</style>

@section Scripts {
    <script>
        // Auto-submit form on filter change
        document.querySelector('select[name="category"]').addEventListener('change', function() {
            document.getElementById('searchForm').submit();
        });

        // Add animation on page load
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.event-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = 'all 0.5s ease';
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, 50);
                }, index * 50);
            });
        });
    </script>
}